# Default nginx configuration for masiva - change to suit your requirements

server {

        listen       80;
        server_name  masiva-server;
        autoindex on;


	# Configure logs
        access_log  /opt/masiva/logs/nginx/masiva.access.log;
        error_log  /opt/masiva/logs/nginx/masiva.error.log;
	
	# Point the base at the www folder
	location / {
		root   /opt/masiva/lib/www;
        	index  index.php;
	}
        
	
        # Proxy for local jetty instance
	location /masiva {
            proxy_pass         http://127.0.0.1:8080/masiva;
            proxy_redirect     off;

            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;

            client_max_body_size       10m;
            client_body_buffer_size    128k;

            proxy_connect_timeout      90;
            proxy_send_timeout         90;
            proxy_read_timeout         90;

            proxy_buffer_size          4k;
            proxy_buffers              4 32k;
            proxy_busy_buffers_size    64k;
            proxy_temp_file_write_size 64k;
        }

        location /videos {
            mp4;
	    root /opt/masiva/src/web-app;
        }

	location /images {
	   root /opt/masiva/src/web-app;
	}


## Parse all .php file in the /opt/masiva/lib/www directory
    location ~ .php$ {
        fastcgi_split_path_info ^(.+\.php)(.*)$;
        fastcgi_pass   backend;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  /opt/masiva/lib/www$fastcgi_script_name;
        include fastcgi_params;
        fastcgi_param  QUERY_STRING     $query_string;
        fastcgi_param  REQUEST_METHOD   $request_method;
        fastcgi_param  CONTENT_TYPE     $content_type;
        fastcgi_param  CONTENT_LENGTH   $content_length;
        fastcgi_intercept_errors        on;
        fastcgi_ignore_client_abort     off;
        fastcgi_connect_timeout 60;
        fastcgi_send_timeout 180;
        fastcgi_read_timeout 180;
        fastcgi_buffer_size 128k;
        fastcgi_buffers 4 256k;
        fastcgi_busy_buffers_size 256k;
        fastcgi_temp_file_write_size 256k;
    }

        # Static files location
        #location ~* ^.+.(jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|txt|tar|mid|midi|wav|bmp|rtf|js)$ {
        #    root   /spool/www/members_ng;
        #}

}

upstream backend {
        server 127.0.0.1:9000;
}

